YUI.add("aui-datatable-edit",function(e,t){var n=e.Lang,r=e.Array,i=e.Escape,s=n.isArray,o=n.isBoolean,u=n.isFunction,a=n.isObject,f=n.isString,l=n.isValue,c=n.String,h=e.DataType,p=function(t){return t instanceof e.BaseCellEditor},d=e.WidgetStdMod,v=e.getClassName,m=e.getDoc(),g="activeCell",y="add",b="addOption",w="baseCellEditor",E="boundingBox",S="calendar",x="cancel",T="cell",N="celleditor",C="checkboxCellEditor",k="checked",L="click",A="contentBox",O="data",M="datatable",_="dateCellEditor",D="dd",P="delete",H="disk",B="dropDownCellEditor",j="edit",F="editEvent",I="editOptions",q="editable",R="editor",U="element",z="elementName",W="grip",X="handle",V="hide",$="hideOnSave",J="icon",K="initEdit",Q="initToolbar",G="initValidator",Y="input",Z="inputFormatter",et="key",tt="label",nt="link",rt="mousedown",it="multiple",t="name",st="only",ot="option",ut="optionName",at="optionValue",ft="options",lt="optionsCellEditor",ct="outputFormatter",ht="pencil",pt="radioCellEditor",dt="read",vt="readOnly",mt="remove",gt="render",yt="rendered",bt="resize",wt="return",Et="row",St="save",xt="selected",Tt="selectedAttrName",Nt="showToolbar",Ct="submit",kt="textAreaCellEditor",Lt="textCellEditor",At="toolbar",Ot="unescapeValue",Mt="validator",_t="value",Dt="vertical",Pt="visible",Ht="wrapper",Bt="zIndex",jt=",",Ft=".",It="",qt="\n",Rt=" ",Ut=/<br\s*\/?>/gi,zt=/[\r\n]/g,Wt=v(N,j),Xt=v(N,j,y,ot),Vt=v(N,j,D,X),$t=v(N,j,P,ot),Jt=v(N,j,V,ot),Kt=v(N,j,Y,t),Qt=v(N,j,Y,_t),Gt=v(N,j,tt),Yt=v(N,j,nt),Zt=v(N,j,ot,Et),en=v(N,U),tn=v(N,ot),nn=v(M,q),rn=v(J),sn=v(J,bt,Dt),on="<br/>",un=function(){};un.NAME="dataTableCellEditorSupport",un.EDITOR_ZINDEX=9999,un.ATTRS={editEvent:{setter:"_setEditEvent",validator:f,value:L}},e.mix(un.prototype,{initializer:function(){var e=this,t=e.get(F);e.CLASS_NAMES_CELL_EDITOR_SUPPORT={cell:e.getClassName(T),readOnly:e.getClassName(dt,st)},e.after(gt,e._afterCellEditorSupportRender),e.delegate(t,e._onEditCell,Ft+e.CLASS_NAMES_CELL_EDITOR_SUPPORT.cell,e)},getEditor:function(e,t){var n=this,r=t.editor,i=e.get(R);return r===!1||i===!1?null:i||r},_afterCellEditorSupportRender:function(){var t=this;t._syncModelsReadOnlyUI(),t.body.after(e.bind(t._syncModelsReadOnlyUI,t),t.body,gt)},_onEditCell:function(t){var n=this,r=n.get(g),i=t.alignNode||r,s=n.getColumn(i),o=n.getRecord(i),u=n.getEditor(o,s);p(u)&&!o.get(vt)&&(u.get(yt)||(u.on({visibleChange:e.bind(n._onEditorVisibleChange,n),save:e.bind(n._onEditorSave,n)}),u.set(Bt,un.EDITOR_ZINDEX),u.render()),u.set(_t,o.get(s.key)),u.show().move(i.getXY()))},_onEditorSave:function(e){var t=this,n=e.currentTarget,r=t.getActiveColumn(),i=t.getActiveRecord();n.set(_t,e.newVal),t.set(g,t.get(g)),i.set(r.key,n.formatValue(n.get(ct),e.newVal)),t.highlight&&t.highlight.clear()},_onEditorVisibleChange:function(e){var t=this,n=e.currentTarget;e.newVal&&n._syncFocus()},_syncModelReadOnlyUI:function(e){var t=this,n=t.getRow(e);n.toggleClass(t.CLASS_NAMES_CELL_EDITOR_SUPPORT[vt],e.get(vt)===!0)},_syncModelsReadOnlyUI:function(){var e=this;e.get(O).each(function(t){e._syncModelReadOnlyUI(t)})},getCellEditor:function(){return this.getEditor.apply(this,arguments)},getRecordColumnValue:function(e,t){return e.get(t.key)}}),e.DataTable.CellEditorSupport=un,e.Base.mix(e.DataTable,[un]);var an=e.Component.create({NAME:w,ATTRS:{editable:{value:!1,validator:o},elementName:{value:_t,validator:f},footerContent:{value:It},hideOnSave:{value:!0,validator:o},inputFormatter:{value:function(e){return f(e)&&(e=e.replace(zt,on)),e}},outputFormatter:{value:function(e){var t=this;return f(e)&&(t.get(Ot)&&(e=c.unescapeEntities(e)),e=e.replace(Ut,qt)),e}},showToolbar:{value:!0,validator:o},strings:{value:{edit:"Edit",save:"Save",cancel:"Cancel"}},tabIndex:{value:1},toolbar:{setter:"_setToolbar",validator:a,value:null},unescapeValue:{value:!0,validator:o},validator:{setter:"_setValidator",validator:a,value:null},value:{value:It},visible:{value:!1}},EXTENDS:e.Overlay,UI_ATTRS:[q,Nt,_t],prototype:{CONTENT_TEMPLATE:"<form></form>",ELEMENT_TEMPLATE:null,elements:null,validator:null,_hDocEscKeyEv:null,_hDocMouseDownEv:null,initializer:function(e){var t=this;t._initEvents()},destructor:function(){var e=this,t=e._hDocEscKeyEv,n=e._hDocMouseDownEv,r=e.toolbar,i=e.validator;t&&t.detach(),n&&n.detach(),r&&r.destroy(),i&&i.destroy()},formatValue:function(e,t){var n=this;return u(e)&&(t=e.call(n,t)),t},getValue:function(){var e=this;return e.formatValue(e.get(Z),e.getElementsValue())},_initEvents:function(){var t=this;t.publish({cancel:{defaultFn:t._defCancelFn},initEdit:{defaultFn:t._defInitEditFn,fireOnce:!0},initValidator:{defaultFn:t._defInitValidatorFn,fireOnce:!0},initToolbar:{defaultFn:t._defInitToolbarFn,fireOnce:!0},save:{defaultFn:t._defSaveFn}}),t.after({render:t._afterRender,visibleChange:e.debounce(t._debounceVisibleChange,350,t)}),t.on({"form-validator:submit":e.bind(t._onSubmit,t)})},_afterRender:function(){var e=this;e._handleInitValidatorEvent(),e._handleInitToolbarEvent()},_defCancelFn:function(e){var t=this;t.hide()},_defInitValidatorFn:function(t){var n=this;n.validator=new e.FormValidator(n.get(Mt))},_defInitToolbarFn:function(t){var n=this,r=n.get(q);n.toolbar=(new e.Toolbar(n.get(At))).render(n.footerNode),r&&n._uiSetEditable(r)},_defSaveFn:function(e){var t=this;t.get($)&&t.hide()},_debounceVisibleChange:function(t){var n=this,r=n._hDocEscKeyEv,i=n._hDocMouseDownEv;t.newVal?(r||(n._hDocEscKeyEv=m.on(et,e.bind(n._onEscKey,n),"down:27")),i||(n._hDocMouseDownEv=m.on(rt,e.bind(n._onDocMouseDownExt,n)))):(r&&(r.detach(),n._hDocEscKeyEv=null),i&&(i.detach(),n._hDocMouseDownEv=null))},_handleCancelEvent:function(){var e=this;e.fire(x)},_handleEditEvent:function(){var e=this;e.fire(j)},_handleInitEditEvent:function(){var e=this;e.get(yt)&&this.fire(K)},_handleInitValidatorEvent:function(){var e=this;e.get(yt)&&this.fire(G)},_handleInitToolbarEvent:function(){var e=this;e.get(yt)&&e.get(Nt)&&this.fire(Q)},_handleSaveEvent:function(){var e=this;e.validator.validate(),e.validator.hasErrors
()||e.fire(St,{newVal:e.getValue(),prevVal:e.get(_t)})},_onDocMouseDownExt:function(e){var t=this,n=t.get(E);n.contains(e.target)||t._handleCancelEvent()},_onEscKey:function(e){var t=this;t.hide()},_onSubmit:function(e){var t=this,n=e.validator;n&&n.formEvent.halt()},_setToolbar:function(t){var n=this,r=n.getStrings();return e.merge({activeState:!1,children:[[{on:{click:e.bind(n._handleSaveEvent,n)},label:r[St],icon:"icon-ok-sign"},{on:{click:e.bind(n._handleCancelEvent,n)},label:r[x]}]]},t)},_setValidator:function(t){var n=this;return e.merge({boundingBox:n.get(A),bubbleTargets:n},t)},_uiSetShowToolbar:function(e){var t=this,n=t.footerNode;e?n.show():n.hide(),t._handleInitToolbarEvent()},getElementsValue:function(){var e=this,t=e.elements;return t?t.get(_t):It},renderUI:function(){var t=this;t.ELEMENT_TEMPLATE&&(t.elements=e.Node.create(t.ELEMENT_TEMPLATE),t._syncElementsName(),t.setStdModContent(d.BODY,t.elements))},_defInitEditFn:function(e){},_syncElementsFocus:function(){var e=this;e.elements.selectText()},_syncElementsName:function(){var e=this;e.elements.setAttribute(t,e.get(z))},_syncFocus:function(){var t=this;e.later(0,t,t._syncElementsFocus)},_uiSetEditable:function(t){var n=this,r=n.toolbar;n.get(yt)&&r&&(t?r.add([{icon:"icon-edit",label:n.getString(j),on:{click:e.bind(n._handleEditEvent,n)}}],1):r.remove(1))},_uiSetValue:function(e){var t=this,n=t.elements;n&&n.val(t.formatValue(t.get(ct),e))}}});e.BaseCellEditor=an;var fn=e.Component.create({NAME:lt,ATTRS:{hideEditContainerOnSave:{value:!0,validator:o},inputFormatter:{value:null},options:{setter:"_setOptions",value:{},validator:a},optionsValidatorCustomRules:{validator:a,valueFn:function(){var e=this;return{uniqueValue:{condition:function(e,t){var n=this,r=t.ancestor(Ft+Wt),i=r.all(Ft+Qt),s=function(e,t,r){var o=!1;return t.each(function(t){e!==t&&(e.val()==t.val()&&(n.highlight(e),n.addFieldError(e,"uniqueValue"),o=!0),r&&s(t,i,!1))}),o||(n.resetField(e),n.highlight(e,!0)),!o};return s(t,i,!0)},errorMessage:e.getStrings().valueNotUnique}}}},optionsValidatorInputRules:{validator:a,value:{custom:!0,uniqueValue:!0}},outputFormatter:{value:null},selectedAttrName:{value:xt,validator:f},strings:{value:{add:"Add",addOption:"Add option",cancel:"Cancel",edit:"Edit options",editOptions:"Edit option(s)",name:"Name",optionName:"Option Name",optionValue:"Option Value",remove:"Remove",save:"Save",stopEditing:"Stop editing",value:"Value",valueNotUnique:"Value not unique."}}},EXTENDS:e.BaseCellEditor,UI_ATTRS:[ft],prototype:{EDIT_TEMPLATE:'<div class="'+Wt+'"></div>',EDIT_OPTION_ROW_TEMPLATE:'<div class="form-inline '+Zt+'">'+'<div class="control-group">'+'<span class="'+[Vt,rn,sn].join(Rt)+'"></span>'+"</div>"+'<div class="control-group">'+'<label class="celleditor-edit-sr-only" for="{optionValueName}_name">{labelOptionName}</label>'+'<input class="'+Kt+' input-block-level input-small" size="7" id="{optionValueName}_name" placeholder="{titleName}" title="{titleName}" type="text" value="{valueName}" /> '+"</div>"+'<div class="control-group">'+'<label class="celleditor-edit-sr-only" for="{optionValueName}">{labelOptionValue}</label>'+'<input class="'+Qt+' input-block-level input-small" id="{optionValueName}" name="{optionValueName}" placeholder="{titleValue}" size="7" title="{titleValue}" type="text" value="{valueValue}" /> '+"</div>"+'<div class="control-group">'+'<button aria-label="{remove}" class="close '+[Yt,$t].join(Rt)+'" type="button"><span aria-hidden="true">&times;</span></button>'+"</div>"+"</div>"+"</div>",EDIT_ADD_LINK_TEMPLATE:'<div class="control-group"><a class="'+[Yt,Xt].join(Rt)+'" href="javascript:void(0);">{addOption}</a></div> ',EDIT_LABEL_TEMPLATE:'<div class="'+Gt+'">{editOptions}</div>',editContainer:null,editSortable:null,options:null,initializer:function(){var t=this;t.on(j,t._onEditEvent),t.on(St,t._onSave),t.after(Q,t._afterInitToolbar),e.FormValidator.addCustomRules(t.get("optionsValidatorCustomRules"))},addNewOption:function(t,n){var r=this,i=r.editContainer.one(Ft+Xt),s=e.Node.create(r._createEditOption(t||It,n||It));i.placeBefore(s),s.one(Y).focus()},removeOption:function(e){e.remove()},saveOptions:function(){var e=this,t=e.editContainer;if(t&&!t.hasAttribute("hidden")){var n=t.all(Ft+Kt),r=t.all(Ft+Qt),i={};n.each(function(e,t){var n=e.val(),s=r.item(t).val();i[s]=n}),e.set(ft,i),e.get("hideEditContainerOnSave")&&e.toggleEdit()}},toggleEdit:function(){var e=this;e.editContainer.toggle()},_createOptions:function(t){var r=this,s=r.elements,o=[],u=[],a=r.OPTION_TEMPLATE,f=r.OPTION_WRAPPER;e.each(t,function(t,r){var s={id:e.guid(),label:i.html(t),name:i.html(r),value:i.html(r)};a&&o.push(n.sub(a,s)),f&&u.push(n.sub(f,s))});var l=e.NodeList.create(o.join(It)),c=e.NodeList.create(u.join(It));c.size()?(c.each(function(e,t){e.prepend(l.item(t))}),s.setContent(c)):s.setContent(l),r.options=l},_createEditBuffer:function(){var t=this,r=t.getStrings(),i=[];return i.push(n.sub(t.EDIT_LABEL_TEMPLATE,{editOptions:r[I]})),e.each(t.get(ft),function(e,n){i.push(t._createEditOption(e,n))}),i.push(n.sub(t.EDIT_ADD_LINK_TEMPLATE,{addOption:r[b]})),i.join(It)},_createEditOption:function(r,s){var o=this,u=e.guid()+"_value",a=o.getStrings();return o.validator.get("rules")[u]=o.get("optionsValidatorInputRules"),n.sub(o.EDIT_OPTION_ROW_TEMPLATE,{labelOptionName:i.html(a[ut]),labelOptionValue:i.html(a[at]),optionValueName:i.html(u),remove:a[mt],titleName:i.html(a[t]),titleValue:i.html(a[_t]),valueName:i.html(r),valueValue:i.html(s)})},_defInitEditFn:function(t){var n=this,r=e.Node.create(n.EDIT_TEMPLATE);r.delegate("click",e.bind(n._onEditLinkClickEvent,n),Ft+Yt),r.delegate("keydown",e.bind(n._onEditKeyEvent,n),Y),n.editContainer=r,n.setStdModContent(d.BODY,r.hide(),d.AFTER),n.editSortable=(new e.Sortable({container:r,handles:[Ft+Vt],nodes:Ft+Zt,opacity:".3"})).delegate.dd.plug(e.Plugin.DDConstrained,{constrain:r,stickY:!0}),n._syncEditOptionsUI()},_getSelectedOptions:function(){var t=this,n=[];return t.options.each(function(e){e.get(
t.get(Tt))&&n.push(e)}),e.all(n)},_onEditEvent:function(e){var t=this;t._handleInitEditEvent(),t.toggleEdit(),t._syncEditOptionsUI()},_onEditLinkClickEvent:function(e){var t=this,n=e.currentTarget;n.test(Ft+Xt)?t.addNewOption():n.test(Ft+Jt)?t.toggleEdit():n.test(Ft+$t)&&t.removeOption(n.ancestor(Ft+Zt)),e.halt()},_onEditKeyEvent:function(e){var t=this,n=e.currentTarget;if(e.isKey(wt)){var r=n.next(Y);r?r.selectText():t.addNewOption(),e.halt()}},_onSave:function(e){var t=this;t.saveOptions()},_setOptions:function(e){var t={};return s(e)?r.each(e,function(e){t[e]=e}):a(e)&&(t=e),t},_syncEditOptionsUI:function(){var e=this;e.editContainer.setContent(e._createEditBuffer())},_uiSetOptions:function(e){var t=this;t._createOptions(e),t._uiSetValue(t.get(_t)),t._syncElementsName()},_uiSetValue:function(e){var t=this,o=t.options;return o&&o.size()&&(o.set(t.get(Tt),!1),l(e)&&(s(e)||(e=String(e).split(jt)),r.each(e,function(e){o.filter('[value="'+i.html(n.trim(e))+'"]').set(t.get(Tt),!0)}))),e}}});e.BaseOptionsCellEditor=fn;var ln=e.Component.create({NAME:Lt,EXTENDS:e.BaseCellEditor,prototype:{ELEMENT_TEMPLATE:'<input autocomplete="off" class="'+en+'" type="text" />'}});e.TextCellEditor=ln;var cn=e.Component.create({NAME:kt,EXTENDS:e.BaseCellEditor,prototype:{ELEMENT_TEMPLATE:'<textarea class="'+en+'"></textarea>'}});e.TextAreaCellEditor=cn;var hn=e.Component.create({NAME:B,ATTRS:{multiple:{value:!1,validator:o}},EXTENDS:e.BaseOptionsCellEditor,UI_ATTRS:[it],prototype:{ELEMENT_TEMPLATE:'<select class="'+en+'"></select>',OPTION_TEMPLATE:'<option value="{value}">{label}</option>',getElementsValue:function(){var e=this;return e.get(it)?e._getSelectedOptions().get(_t):e.elements.get(_t)},_syncElementsFocus:function(){var e=this;e.elements.focus()},_uiSetMultiple:function(e){var t=this,n=t.elements;e?n.setAttribute(it,it):n.removeAttribute(it)}}});e.DropDownCellEditor=hn;var pn=e.Component.create({NAME:C,ATTRS:{selectedAttrName:{value:k}},EXTENDS:e.BaseOptionsCellEditor,prototype:{ELEMENT_TEMPLATE:'<div class="'+en+'"></div>',OPTION_TEMPLATE:'<input class="'+tn+'" id="{id}" name="{name}" type="checkbox" value="{value}"/>',OPTION_WRAPPER:'<label class="checkbox" for="{id}"> {label}</label>',getElementsValue:function(){var e=this;return e._getSelectedOptions().get(_t)},_syncElementsFocus:function(){var e=this,t=e.options;t&&t.size()&&t.item(0).focus()},_syncElementsName:function(){var e=this,n=e.options;n&&n.setAttribute(t,e.get(z))}}});e.CheckboxCellEditor=pn;var dn=e.Component.create({NAME:pt,EXTENDS:e.CheckboxCellEditor,prototype:{OPTION_TEMPLATE:'<input class="field-input-choice" id="{id}" name="{name}" type="radio" value="{value}"/>',OPTION_WRAPPER:'<label class="radio" for="{id}"> {label}</label>',getElementsValue:function(){var e=this;return e._getSelectedOptions().get(_t)[0]}}});e.RadioCellEditor=dn;var vn=e.Component.create({NAME:_,EXTENDS:e.BaseCellEditor,ATTRS:{bodyContent:{value:It},calendar:{setter:"_setCalendar",validator:a,value:null},dateFormat:{value:"%Y-%m-%d",validator:f},inputFormatter:{value:function(e){var t=this,n=[];return r.each(e,function(e,r){n.push(t.formatDate(e).toString())}),n}},outputFormatter:{value:function(e){var t=this,n=[];return r.each(e,function(e,r){n.push(h.Date.parse(t.get("dateFormat"),e))}),n}}},prototype:{ELEMENT_TEMPLATE:'<input class="'+en+'" type="hidden" />',initializer:function(){var t=this;t.after("calendar:dateClick",e.bind(t._afterDateSelect,t))},getElementsValue:function(){var e=this;return e.calendar.get("selectedDates")},formatDate:function(e){var t=this,n=t.get("dateFormat"),r=t.get("locale");return h.Date.format(e,{format:n,locale:r})},_afterDateSelect:function(e){var t=this,n=t.calendar.get("selectedDates");t.elements.val(r.invoke(n,"getTime").join(jt))},_afterRender:function(){var t=this;e.DateCellEditor.superclass._afterRender.apply(t,arguments),t.calendar=(new e.Calendar(t.get(S))).render(t.bodyNode)},_setCalendar:function(t){var n=this;return e.merge({bubbleTargets:n},t)},_uiSetValue:function(e){var t=this,n=t.calendar,r;n&&(s(e)||(e=[e]),r=t.formatValue(t.get(ct),e),n._clearSelection(),r[0]?(n.set("date",r[0]),n.selectDates(r)):n.set("date",new Date))}}});e.DateCellEditor=vn},"2.0.0",{requires:["datatable-base","calendar","escape","overlay","sortable","aui-datatype","aui-toolbar","aui-form-validator","aui-datatable-core"],skinnable:!0});
